# マッチングサービス仕様書

## 1. システム概要

本システムは個人ユーザーと法人ユーザーのマッチングを行う求人サービスです。個人ユーザーは希望条件やスキルを登録し、法人ユーザーは求人情報を登録します。システムは条件に基づいて最適なマッチングを提供します。

## 2. ユーザータイプとプロフィール

### 2.1 ユーザータイプ
- **個人ユーザー**: 求職者として利用
- **法人ユーザー**: 採用企業として利用

### 2.2 個人プロフィール (`IndividualProfile`)
- 表示名
- 希望年収（desired_salary）: 万円単位で保存
- その他のプロフィール情報

### 2.3 企業プロフィール (`CompanyProfile`)
- 会社名（company_name）: 必須
- Webサイト（website_url）: 任意
- 会社の説明（description）: 任意

## 3. 求人管理機能

### 3.1 求人（Job）モデル
- タイトル（title）: 必須
- 業務内容（description）: 必須
- 雇用形態（employment_type_id）: 必須
- 勤務形態（work_style_id）: 必須
- 勤務地（location_id）: 必須
- 年収（salary_min）: 万円単位、任意
- 法的情報（legal_info）: 任意

### 3.2 求人に必要なスキル（JobSkill）
- スキルID（skill_id）
- レベル（level）: 1-5の整数値

### 3.3 スキルレベル定義
1. **基礎レベル**: 基本的な知識がある
2. **初級レベル**: 簡単な作業が一人でできる
3. **中級レベル**: 実務経験があり、一般的なタスクをこなせる
4. **上級レベル**: 高度な知識と経験を持ち、複雑な問題を解決できる
5. **エキスパートレベル**: 専門家として他者に指導できる

## 4. 個人の希望条件

### 4.1 希望勤務地（UserLocation）
- 複数選択可能

### 4.2 希望雇用形態（UserEmploymentType）
- 複数選択可能

### 4.3 希望勤務形態（UserWorkStyle）
- 複数選択可能

### 4.4 スキル（UserSkill）
- スキルID（skill_id）
- レベル（level）: 1-5の整数値

## 5. マッチングロジック

### 5.1 個人ユーザー向けマッチング求人検索
1. **基本条件**
   - 勤務地が一致（個人の希望勤務地に求人の勤務地が含まれる）
   - 雇用形態が一致（個人の希望雇用形態に求人の雇用形態が含まれる）
   - 勤務形態が一致（個人の希望勤務形態に求人の勤務形態が含まれる）

2. **年収条件**
   - 求人の最低年収 >= 個人の希望年収
   - 希望年収が設定されていない場合は無視

3. **スキル条件**
   - 求人が要求するすべてのスキルについて、個人のスキルレベルが求人の要求レベル以上であること
   - 求人にスキル要件がない場合はスキル条件を無視

### 5.2 求人向けマッチング個人検索
1. **基本条件**
   - 勤務地が一致
   - 雇用形態が一致
   - 勤務形態が一致

2. **年収条件**
   - 個人の希望年収 <= 求人の最低年収
   - 希望年収が設定されていない場合は無視

3. **スキル条件**
   - 求人が要求するすべてのスキルについて、個人のスキルレベルが求人の要求レベル以上であること
   - 求人にスキル要件がない場合はスキル条件を無視

## 6. Rakeタスク

### 6.1 ユーザー向けマッチング求人検索
```
rake "matching:find_jobs_for_user[user_id]"
```

### 6.2 求人向けマッチングユーザー検索
```
rake "matching:find_users_for_job[job_id]"
```

### 6.3 マッチングデバッグ
```
rake "matching:debug_matching[user_id]"
```

## 7. 注意事項

- 年収は最低年収（salary_min）のみを管理・表示します
- マッチングでは3つの基本条件（勤務地、雇用形態、勤務形態）がすべて一致する必要があります
- スキル条件は厳格であり、求人が要求するすべてのスキルを個人が満たす必要があります
